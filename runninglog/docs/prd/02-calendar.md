# PRD: 캘린더 (기록) 탭

> **문서 버전**: v1.0
> **최종 수정일**: 2025-01-30
> **담당**: 러닝로그 모바일 팀

---

## 1. 개요

### 1.1 목적

캘린더 탭("기록")은 사용자가 자신의 러닝 기록을 **시간 축** 기준으로 한눈에 조회하고, 기간별 통계를 확인할 수 있는 핵심 퍼널이다. 사용자가 "언제, 얼마나 달렸는지"를 직관적으로 파악하고, 꾸준한 러닝 습관을 시각적으로 확인할 수 있도록 한다.

### 1.2 사용자 가치

| 가치 | 설명 |
|------|------|
| **습관 시각화** | 달린 날이 오렌지 배경으로 표시되어, 러닝 빈도를 캘린더에서 즉시 파악할 수 있다 |
| **기간별 요약** | 주간/월간/연간 뷰 전환으로 원하는 단위의 기록을 빠르게 확인한다 |
| **성장 확인** | 누적 거리, 횟수, 누적 시간, 평균 페이스 등 핵심 지표를 통해 성장을 실감한다 |
| **상세 회고** | 개별 러닝 기록 리스트를 통해 각 세션의 세부 데이터를 확인한다 |

### 1.3 진입점

- 하단 탭바의 **"기록"** 탭 (아이콘: `directions-run`, 두 번째 탭)
- 탭 라우트: `/(tabs)/run`

---

## 2. 사용자 흐름

```
[하단 탭바 "기록" 탭 터치]
    │
    ▼
[캘린더 메인 (월간 뷰 - 기본)]
    │
    ├─ 뷰 전환 세그먼트 터치 ──► [주간 뷰] / [월간 뷰] / [연간 뷰]
    │
    ├─ 월 네비게이션 (< >) ──► 이전/다음 기간으로 이동
    │
    ├─ 캘린더 날짜 터치 ──► 해당 날짜의 상세 기록으로 스크롤
    │
    ├─ "분석보기" 버튼 터치 ──► 분석 화면으로 이동
    │
    └─ 상세 기록 아이템 터치 ──► 개별 러닝 상세 화면으로 이동
```

### 2.1 흐름 상세

1. **탭 진입**: 사용자가 하단 탭바에서 "기록"을 터치하면, 월간 뷰가 기본으로 표시된다. 현재 월이 선택된 상태이며, 오늘 날짜가 강조 표시된다.
2. **뷰 전환**: 상단 세그먼트 컨트롤(주간 | 월간 | 연간)을 터치하여 뷰를 전환한다. 전환 시 해당 뷰에 맞는 네비게이션과 캘린더 그리드가 갱신된다.
3. **기간 네비게이션**: `<` / `>` 화살표를 터치하여 이전/다음 기간으로 이동한다. 스와이프 제스처도 지원한다.
4. **기록 확인**: 캘린더 하단의 "전체 기록" 섹션에서 해당 기간의 요약 통계와 상세 러닝 기록 리스트를 확인한다.
5. **분석보기**: "분석보기" 버튼을 통해 더 상세한 통계/차트 화면으로 이동한다.

---

## 3. 화면별 상세 스펙

### 3.1 캘린더 메인 - 월간 뷰 (기본 화면)

월간 뷰는 캘린더 탭 진입 시 기본으로 표시되는 화면이다. 다크 모드와 라이트 모드를 모두 지원한다.

#### 3.1.1 헤더

| 속성 | 값 |
|------|-----|
| 텍스트 | "기록" |
| 스타일 | Bold, 대형 타이틀 |
| 위치 | Safe Area 내부, 좌측 정렬 |
| 다크 모드 | 텍스트 밑줄(underline) 장식 포함 |

#### 3.1.2 뷰 전환 세그먼트 컨트롤

| 속성 | 값 |
|------|-----|
| 세그먼트 항목 | `주간` / `월간` / `연간` |
| 기본 선택 | `월간` |
| 활성 스타일 | 오렌지 텍스트(`#FF6F00`) + 배경 필(라이트 모드), 흰 텍스트 + 어두운 배경(다크 모드) |
| 비활성 스타일 | 회색 텍스트, 투명 배경 |
| 형태 | pill 형태의 라운드 세그먼트, 3등분 |

#### 3.1.3 월 네비게이션

| 속성 | 값 |
|------|-----|
| 형식 | `< 2025년 1월 >` |
| 좌측 화살표 | 이전 월로 이동 |
| 우측 화살표 | 다음 월로 이동 |
| 텍스트 스타일 | Bold, 중형 |
| 제스처 | 좌/우 스와이프로 월 이동 지원 |

#### 3.1.4 월간 캘린더 그리드

| 속성 | 값 |
|------|-----|
| 요일 헤더 | `월` `화` `수` `목` `금` `토` `일` (월요일 시작) |
| 그리드 | 7열 x 최대 6행 |
| 셀 크기 | 정사각형, 균등 분할 |
| **달린 날** | 오렌지 배경(`#FF6F00`), 흰색 텍스트, 라운드 사각형 |
| **오늘 날짜** | 오렌지 텍스트(`#FF6F00`) + 약간 두꺼운 테두리 강조 (달리지 않았어도 표시) |
| **달리지 않은 날** | 기본 텍스트, 투명 배경 |
| **전월/익월 날짜** | 흐린 텍스트(opacity 낮춤), 터치 불가 또는 터치 시 해당 월로 이동 |
| 터치 동작 | 달린 날 터치 시 하단 상세 기록 리스트의 해당 날짜로 스크롤 |

#### 3.1.5 전체 기록 섹션

캘린더 그리드 아래에 위치하며, 해당 월의 누적 기록을 표시한다.

| 요소 | 설명 |
|------|------|
| 섹션 타이틀 | "전체 기록" (좌측 정렬, Bold) |
| 분석보기 버튼 | 우측 정렬, 아이콘(차트) + "분석보기" 텍스트, 라운드 아웃라인 버튼 |
| 누적 거리 | "누적 거리" 레이블 + **5.23** km (대형 Bold 숫자) |

#### 3.1.6 요약 카드

누적 거리 아래에 위치하는 단일 카드. 3개 지표를 수평으로 균등 배치한다.

| 지표 | 예시 값 | 레이블 |
|------|---------|--------|
| 횟수 | **8** | 횟수 |
| 누적 시간 | **5:12:13** | 누적 시간 |
| 평균 페이스 | **5'24"** | 평균 페이스 |

| 카드 속성 | 값 |
|-----------|-----|
| 배경 | 라이트: `#F5F5F5` (surface), 다크: `#171717` (surface) |
| 모서리 | 라운드 12px |
| 패딩 | 수평 16px, 수직 16px |
| 구분 | 3칸 균등 분할, 세로 구분선 없음 |
| 숫자 스타일 | Bold, 대형 |
| 레이블 스타일 | Regular, 소형, 하위 텍스트 |

#### 3.1.7 분석보기 버튼

| 속성 | 값 |
|------|-----|
| 위치 | "전체 기록" 타이틀 우측 |
| 스타일 | 아웃라인(border) 라운드 버튼 |
| 아이콘 | 차트 아이콘 (bar chart) |
| 텍스트 | "분석보기" |
| 동작 | 분석 화면으로 라우터 이동 |

#### 3.1.8 상세 기록 리스트

| 속성 | 값 |
|------|-----|
| 섹션 타이틀 | "상세 기록" (좌측 정렬, Bold) |
| 아이템 구조 | 메인 라인: `5.2 km · 28:30 · 5'29"/km` |
| | 서브 라인: `1월 30일 01:51` |
| 구분선 | 아이템 간 얇은 구분선 (1px, border 색상) |
| 정렬 | 최신순 (내림차순) |
| 스크롤 | 전체 화면 스크롤에 포함 (FlatList 아님, ScrollView 내부) |
| 터치 동작 | 아이템 터치 시 개별 러닝 상세 화면으로 이동 |

---

### 3.2 주간 뷰

주간 뷰는 세그먼트에서 "주간"을 선택했을 때 표시된다.

#### 3.2.1 주간 네비게이션

| 속성 | 값 |
|------|-----|
| 형식 | `< 2025년 1월 3주차 >` |
| 좌측 화살표 | 이전 주로 이동 |
| 우측 화살표 | 다음 주로 이동 |
| 주차 계산 | 해당 월 기준 주차 (1일이 포함된 주 = 1주차) |

#### 3.2.2 주간 캘린더

| 속성 | 값 |
|------|-----|
| 요일 헤더 | `월` `화` `수` `목` `금` `토` `일` |
| 표시 | 해당 주의 7일 날짜를 한 행에 표시 |
| **달린 날** | 오렌지 배경(`#FF6F00`), 흰색 텍스트, 라운드 사각형 |
| **오늘 날짜** | 오렌지 텍스트 + 테두리 강조 |
| **달리지 않은 날** | 기본 텍스트, 회색 배경(surface) |
| 셀 크기 | 월간 뷰보다 큰 사각형 (주간이므로 공간 여유) |

#### 3.2.3 하단 영역

- 주간 뷰에서도 월간 뷰와 동일한 구조의 **전체 기록 섹션**, **요약 카드**, **상세 기록 리스트**가 표시된다.
- 데이터 범위만 해당 주(월~일)로 한정된다.

---

### 3.3 연간 뷰

연간 뷰는 세그먼트에서 "연간"을 선택했을 때 표시된다.

#### 3.3.1 연간 네비게이션

| 속성 | 값 |
|------|-----|
| 형식 | `< 2025년 >` |
| 좌측 화살표 | 이전 년도로 이동 |
| 우측 화살표 | 다음 년도로 이동 |

#### 3.3.2 12개월 미니 캘린더 그리드

| 속성 | 값 |
|------|-----|
| 레이아웃 | 2열 x 6행 그리드 (12개월) |
| 각 월 헤더 | "1월", "2월", ... "12월" (좌측 정렬, Bold) |
| 미니 캘린더 | 각 월별 축소 캘린더 (7열, 날짜 숫자 표시) |
| **달린 날** | 오렌지 배경(`#FF6F00`), 흰색 텍스트 |
| **달리지 않은 날** | 기본 텍스트, 투명 배경 |
| 셀 크기 | 소형 (축소 그리드) |
| 터치 동작 | 월 터치 시 해당 월의 월간 뷰로 전환 |

#### 3.3.3 하단 영역

- 연간 뷰에서도 **전체 기록 섹션**, **요약 카드**, **상세 기록 리스트**가 표시된다.
- 데이터 범위는 해당 년도 전체이다.

---

## 4. 데이터 모델

### 4.1 러닝 기록 (RunRecord)

```typescript
interface RunRecord {
  id: string;                  // 고유 식별자 (UUID)
  userId: string;              // 사용자 ID
  date: string;                // 러닝 날짜 (ISO 8601: "2025-01-30")
  startTime: string;           // 시작 시각 (ISO 8601: "2025-01-30T01:51:00+09:00")
  endTime: string;             // 종료 시각
  distanceKm: number;          // 거리 (km, 소수점 2자리)
  durationSeconds: number;     // 소요 시간 (초)
  paceSecondsPerKm: number;    // 평균 페이스 (초/km)
  // 선택적 확장 필드
  calories?: number;           // 소모 칼로리
  avgHeartRate?: number;       // 평균 심박수
  routePolyline?: string;      // 경로 폴리라인 (인코딩된 문자열)
  memo?: string;               // 메모
}
```

### 4.2 기간별 요약 통계 (PeriodSummary)

```typescript
interface PeriodSummary {
  periodType: 'week' | 'month' | 'year';  // 기간 유형
  periodKey: string;                        // 기간 키 ("2025-01", "2025-W03", "2025")
  totalRuns: number;                        // 총 러닝 횟수
  totalDistanceKm: number;                  // 누적 거리 (km)
  totalDurationSeconds: number;             // 누적 시간 (초)
  avgPaceSecondsPerKm: number;              // 평균 페이스 (초/km)
  runDates: string[];                       // 달린 날짜 목록 (["2025-01-05", "2025-01-06", ...])
}
```

### 4.3 캘린더 표시 데이터 (CalendarDayMarker)

```typescript
interface CalendarDayMarker {
  date: string;          // 날짜 ("2025-01-05")
  hasRun: boolean;       // 러닝 기록 존재 여부
  runCount: number;      // 해당 날짜 러닝 횟수
}
```

---

## 5. API 요구사항

### 5.1 기간별 러닝 기록 조회

```
GET /api/v1/runs?startDate={startDate}&endDate={endDate}&page={page}&limit={limit}
```

| 파라미터 | 타입 | 필수 | 설명 |
|----------|------|------|------|
| startDate | string | O | 조회 시작일 (ISO 8601) |
| endDate | string | O | 조회 종료일 (ISO 8601) |
| page | number | X | 페이지 번호 (기본: 1) |
| limit | number | X | 페이지당 아이템 수 (기본: 20) |

**응답 예시:**
```json
{
  "data": [
    {
      "id": "run-001",
      "date": "2025-01-30",
      "startTime": "2025-01-30T01:51:00+09:00",
      "distanceKm": 5.2,
      "durationSeconds": 1710,
      "paceSecondsPerKm": 329
    }
  ],
  "pagination": {
    "page": 1,
    "limit": 20,
    "total": 45,
    "hasNext": true
  }
}
```

### 5.2 기간별 요약 통계 조회

```
GET /api/v1/runs/summary?periodType={periodType}&periodKey={periodKey}
```

| 파라미터 | 타입 | 필수 | 설명 |
|----------|------|------|------|
| periodType | string | O | `week` / `month` / `year` |
| periodKey | string | O | 기간 키 (`2025-01`, `2025-W03`, `2025`) |

**응답 예시:**
```json
{
  "data": {
    "periodType": "month",
    "periodKey": "2025-01",
    "totalRuns": 8,
    "totalDistanceKm": 5.23,
    "totalDurationSeconds": 18733,
    "avgPaceSecondsPerKm": 324,
    "runDates": ["2025-01-01", "2025-01-02", "2025-01-03", "2025-01-05"]
  }
}
```

### 5.3 캘린더 마커 조회 (연간 뷰용)

```
GET /api/v1/runs/calendar-markers?year={year}
```

| 파라미터 | 타입 | 필수 | 설명 |
|----------|------|------|------|
| year | number | O | 조회 연도 |

**응답 예시:**
```json
{
  "data": [
    { "date": "2025-01-01", "hasRun": true, "runCount": 1 },
    { "date": "2025-01-02", "hasRun": true, "runCount": 2 }
  ]
}
```

> **참고**: 연간 뷰에서는 12개월의 모든 날짜 마커가 필요하므로, 별도의 경량 API를 사용하여 성능을 최적화한다.

---

## 6. 상태 관리

### 6.1 캘린더 뷰 상태

```typescript
interface CalendarViewState {
  // 뷰 전환
  activeView: 'week' | 'month' | 'year';    // 현재 활성 뷰 (기본: 'month')

  // 선택된 기간
  selectedYear: number;                       // 선택된 년도 (기본: 현재 년도)
  selectedMonth: number;                      // 선택된 월 1~12 (기본: 현재 월)
  selectedWeek: number;                       // 선택된 주차 1~5 (기본: 현재 주차)

  // 선택된 날짜
  selectedDate: string | null;                // 터치한 날짜 (null이면 미선택)

  // 데이터
  periodSummary: PeriodSummary | null;        // 현재 기간의 요약 통계
  runRecords: RunRecord[];                    // 현재 기간의 러닝 기록 리스트
  calendarMarkers: CalendarDayMarker[];       // 캘린더 마커 데이터

  // 로딩/에러
  isLoading: boolean;
  error: string | null;
}
```

### 6.2 상태 전이 규칙

| 액션 | 상태 변경 |
|------|-----------|
| 뷰 세그먼트 전환 | `activeView` 변경, 데이터 재조회 |
| 이전/다음 네비게이션 | `selectedYear` / `selectedMonth` / `selectedWeek` 변경, 데이터 재조회 |
| 날짜 터치 | `selectedDate` 변경, 상세 기록 리스트 해당 날짜로 스크롤 |
| 탭 재진입 | 현재 날짜 기준으로 상태 유지 (이전 뷰 유지, 스크롤 위치 복원) |
| 앱 백그라운드 복귀 | 오늘 날짜 갱신, 데이터 stale 시 자동 갱신 |

### 6.3 캐싱 전략

- **월간 마커 데이터**: 월 단위로 캐싱. 해당 월 데이터를 한 번 조회하면 캐싱하고, 새 러닝 기록이 추가될 때 무효화한다.
- **요약 통계**: 기간별로 캐싱. 뷰/기간 전환 시 캐시 히트 시 즉시 표시, 백그라운드에서 갱신 확인.
- **상세 기록 리스트**: 페이지네이션 적용, 이전에 로드된 페이지는 캐싱 유지.

---

## 7. 엣지 케이스

### 7.1 기록 없는 달/주/년

| 상황 | 처리 |
|------|------|
| 해당 기간에 러닝 기록이 0건 | 캘린더 그리드는 정상 표시 (오렌지 마킹 없음) |
| 전체 기록 섹션 | 누적 거리 "0.00 km" 표시 |
| 요약 카드 | 횟수 "0" / 누적 시간 "0:00:00" / 평균 페이스 "-'--\"" |
| 상세 기록 리스트 | 빈 상태 메시지: "이 기간에 러닝 기록이 없습니다." |

### 7.2 첫 사용자 (기록 0건)

| 상황 | 처리 |
|------|------|
| 앱 설치 후 첫 진입 | 현재 월의 빈 캘린더 표시 |
| 안내 메시지 | "첫 러닝을 기록해보세요!" 등의 Empty State 메시지 표시 |
| CTA | 러닝 기록 시작 버튼 또는 홈 탭으로의 유도 |

### 7.3 대량 기록 페이지네이션

| 상황 | 처리 |
|------|------|
| 한 달에 30건 이상 기록 | 상세 기록 리스트에 페이지네이션 적용 (20건 단위) |
| 스크롤 끝 도달 | 자동으로 다음 페이지 로드 (무한 스크롤) |
| 로딩 인디케이터 | 추가 로드 시 하단에 스피너 표시 |
| 연간 뷰 마커 | 경량 API 사용, 365일분 마커만 조회 (상세 데이터 미포함) |

### 7.4 날짜 경계 케이스

| 상황 | 처리 |
|------|------|
| 자정 넘김 러닝 | 시작 시각 기준으로 날짜 판정 |
| 타임존 변경 | 디바이스 로컬 타임존 기준 표시 |
| 윤년 2월 | 캘린더 그리드에 29일까지 표시 |
| 12월 → 1월 전환 | 연도 자동 변경 (2025년 12월 → 2026년 1월) |

### 7.5 네트워크/에러

| 상황 | 처리 |
|------|------|
| 네트워크 오프라인 | 캐시된 데이터 표시, 오프라인 배너 노출 |
| API 에러 | "기록을 불러올 수 없습니다. 다시 시도해주세요." + 재시도 버튼 |
| 데이터 로딩 중 | 캘린더 그리드 스켈레톤 UI + 기록 리스트 스켈레톤 UI |

### 7.6 다크 모드 / 라이트 모드

| 요소 | 라이트 모드 | 다크 모드 |
|------|-------------|-----------|
| 배경 | `#FFFFFF` | `#0D0D0D` |
| 텍스트 | `#0D0D0D` | `#FAFAFA` |
| 카드/서피스 | `#F5F5F5` | `#171717` |
| 구분선 | `#E5E5E5` | `#262626` |
| 달린 날 | `#FF6F00` (동일) | `#FF6F00` (동일) |
| 비활성 날짜 | 회색 텍스트 | 어두운 회색 텍스트 |

---

## 부록: 디자인 참고 자료

- 캘린더 메인 (다크/라이트 모드): `docs/prd/calender.png`
- 캘린더 변형 (주간/연간 뷰): `docs/prd/calender-varient.png`
